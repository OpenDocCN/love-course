# 课程：下雪 - P1 🎬

在本节课中，我们将学习如何制作一个简单的下雪动画效果。我们将从核心概念开始，逐步讲解实现步骤，确保即使是编程初学者也能轻松理解并动手实践。

## 概述 📋

我们将创建一个模拟雪花飘落的动画。这个效果主要涉及在屏幕上随机生成多个“雪花”点，并让它们以不同的速度持续向下移动，当雪花移出屏幕底部时，会重新从顶部出现，从而形成循环下雪的场景。

上一节我们介绍了本课程的目标，本节中我们来看看实现这个效果需要哪些核心元素。

## 核心概念与公式 ❄️

实现下雪动画的核心在于管理多个运动的对象（雪花）。每个雪花都需要有**位置**和**速度**这两个基本属性。

*   **位置**：可以用坐标 `(x, y)` 表示。
*   **速度**：在本例中，雪花主要向下（y轴方向）运动，因此我们主要关心 `y` 方向的速度 `vy`。为了让效果更自然，每片雪花的下落速度可以不同。

雪花运动的**基本公式**可以简化为：
`y = y + vy`
这意味着每一帧，雪花的新位置等于其旧位置加上下落速度。

接下来，我们将把这些概念转化为具体的实现步骤。

## 实现步骤 🛠️

以下是创建下雪动画的具体步骤。

1.  **初始化画布与雪花数组**
    首先，我们需要一个HTML画布元素来绘制图形，并创建一个数组来保存所有雪花的数据。

    ```html
    <canvas id="snowCanvas"></canvas>
    ```
    ```javascript
    const canvas = document.getElementById('snowCanvas');
    const ctx = canvas.getContext('2d');
    let snowflakes = []; // 用于存储所有雪花对象的数组
    ```

2.  **定义雪花类**
    创建一个雪花类，用来定义每片雪花的属性和行为。

    ```javascript
    class Snowflake {
        constructor() {
            this.x = Math.random() * canvas.width; // 随机横坐标
            this.y = Math.random() * canvas.height; // 随机纵坐标
            this.vy = 1 + Math.random() * 2; // 随机下落速度
            this.radius = 2 + Math.random() * 2; // 随机半径
        }
        update() {
            this.y += this.vy; // 应用下落公式
            // 如果雪花飘出屏幕底部，则重置到顶部
            if (this.y > canvas.height) {
                this.y = 0;
                this.x = Math.random() * canvas.width;
            }
        }
        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctx.fillStyle = 'white';
            ctx.fill();
        }
    }
    ```

3.  **创建与更新雪花**
    我们需要初始化一批雪花，并在每一帧动画中更新它们的位置并重新绘制。

    ```javascript
    function initSnowflakes(count) {
        snowflakes = [];
        for (let i = 0; i < count; i++) {
            snowflakes.push(new Snowflake());
        }
    }
    function animate() {
        // 清空上一帧的画布
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // 更新并绘制每一片雪花
        for (let flake of snowflakes) {
            flake.update();
            flake.draw();
        }
        // 请求下一帧动画
        requestAnimationFrame(animate);
    }
    // 启动动画
    initSnowflakes(100); // 创建100片雪花
    animate();
    ```

4.  **完善与优化**
    为了使效果更逼真，可以增加一些细节，例如让雪花轻微左右摇摆、根据窗口大小调整画布、或添加渐隐效果。

    ```javascript
    // 在Snowflake类中增加属性
    constructor() {
        // ... 其他属性
        this.wobble = Math.random() * Math.PI * 2; // 摆动相位
        this.wobbleSpeed = 0.01 + Math.random() * 0.02; // 摆动速度
    }
    update() {
        this.y += this.vy;
        // 增加左右摆动
        this.x += Math.sin(this.wobble) * 0.5;
        this.wobble += this.wobbleSpeed;
        // ... 重置逻辑
    }
    ```

## 总结 🎉

本节课中我们一起学习了如何用JavaScript和HTML5 Canvas创建一个基础的下雪动画。

我们掌握了几个关键点：使用**对象数组**来管理大量元素；通过**更新位置**（`y = y + vy`）来实现动画；以及利用 `requestAnimationFrame` 函数来创建流畅的动画循环。

你可以尝试修改雪花数量、速度、大小和摆动幅度等参数，创造出风格各异的雪景。希望这个简单的教程能帮助你入门图形动画编程。